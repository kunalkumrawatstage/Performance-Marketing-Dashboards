<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STAGE Performance Dashboard - Haryanvi Market</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header { background: white; padding: 25px 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #2563eb; font-size: 24px; }
        .header p { color: #666; font-size: 14px; margin-top: 5px; }

        .success { background: #f0fdf4; color: #15803d; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #22c55e; font-size: 14px; }

        .tab-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border: none; background: transparent; color: #666; font-weight: 500; cursor: pointer; border-radius: 6px; transition: all 0.2s; white-space: nowrap; }
        .tab-btn:hover { background: #f3f4f6; color: #2563eb; }
        .tab-btn.active { background: #2563eb; color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .metric-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #2563eb; }
        .metric-card.healthy { border-left-color: #10b981; }
        .metric-card.unhealthy { border-left-color: #ef4444; }
        .metric-label { font-size: 13px; color: #666; margin-bottom: 8px; font-weight: 500; }
        .metric-value { font-size: 28px; font-weight: 700; color: #111; margin-bottom: 5px; }
        .metric-status { font-size: 12px; font-weight: 600; }
        .metric-status.healthy { color: #10b981; }
        .metric-status.unhealthy { color: #ef4444; }

        .chart-section { background: white; border-radius: 10px; padding: 30px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chart-title { font-size: 18px; font-weight: 600; color: #111; margin-bottom: 20px; }
        .chart-container { position: relative; height: 400px; }

        .shows-table { background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f3f4f6; padding: 12px; text-align: left; font-weight: 600; font-size: 13px; color: #374151; border-bottom: 2px solid #e5e7eb; cursor: pointer; }
        th:hover { background: #e5e7eb; }
        td { padding: 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; }
        tr:hover { background: #f9fafb; }
        .channel-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .channel-meta { background: #dbeafe; color: #1e40af; }
        .channel-google { background: #d1fae5; color: #065f46; }

        .insight-card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 5px solid #2563eb; }
        .insight-card.high { border-left-color: #ef4444; }
        .insight-card.medium { border-left-color: #f59e0b; }
        .insight-card.low { border-left-color: #10b981; }
        .insight-badge { display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; }
        .insight-badge.high { background: #fee2e2; color: #991b1b; }
        .insight-badge.medium { background: #fef3c7; color: #92400e; }
        .insight-badge.low { background: #d1fae5; color: #065f46; }
        .insight-title { font-size: 18px; font-weight: 700; color: #111; margin-bottom: 15px; line-height: 1.4; }
        .insight-analysis { font-size: 14px; color: #374151; margin-bottom: 15px; line-height: 1.7; }
        .insight-recommendation { background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 3px solid #2563eb; margin-top: 15px; }
        .insight-recommendation strong { color: #2563eb; }
        .insight-impact { background: #1f2937; color: white; padding: 12px; border-radius: 6px; margin-top: 15px; font-size: 13px; }
        .insight-impact strong { color: #60a5fa; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ðŸ“Š STAGE Performance Dashboard</h1>
                <p>Haryanvi Market â€¢ Data Pre-Loaded âœ…</p>
            </div>
        </div>

        <div class="success">
            âœ… Dashboard generated with 27 show records â€¢ No file upload needed!
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="overall">ðŸ“ˆ Overall Performance</button>
            <button class="tab-btn" data-tab="channel">ðŸŽ¯ Channel Analysis</button>
            <button class="tab-btn" data-tab="platform">ðŸ’» Platform Breakdown</button>
            <button class="tab-btn" data-tab="shows">ðŸŽ¬ Show Performance</button>
            <button class="tab-btn" data-tab="insights">ðŸ¤– AI Insights</button>
        </div>

        <div id="tab-overall" class="tab-content active">
            <div class="metrics-grid" id="metricsGrid"></div>
        </div>

        <div id="tab-channel" class="tab-content">
            <div class="chart-section">
                <div class="chart-title">ðŸ“Š Channel Performance: Meta vs Google</div>
                <div class="chart-container">
                    <canvas id="channelChart"></canvas>
                </div>
            </div>
        </div>

        <div id="tab-platform" class="tab-content">
            <div class="chart-section">
                <div class="chart-title">ðŸ’» Platform Performance: App vs Web</div>
                <div class="chart-container">
                    <canvas id="platformChart"></canvas>
                </div>
            </div>
        </div>

        <div id="tab-shows" class="tab-content">
            <div class="shows-table">
                <div class="chart-title">ðŸ“ˆ Show Performance Details</div>
                <table id="showsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Show â†•</th>
                            <th onclick="sortTable(1)">Channel â†•</th>
                            <th onclick="sortTable(2)">Platform â†•</th>
                            <th onclick="sortTable(3)">Spend (â‚¹) â†•</th>
                            <th onclick="sortTable(4)">Trials â†•</th>
                            <th onclick="sortTable(5)">CAC (â‚¹) â†•</th>
                            <th onclick="sortTable(6)">IR% â†•</th>
                            <th onclick="sortTable(7)">TR% â†•</th>
                            <th onclick="sortTable(8)">TCR% â†•</th>
                            <th onclick="sortTable(9)">CTR% â†•</th>
                        </tr>
                    </thead>
                    <tbody id="showsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-insights" class="tab-content">
            <div class="chart-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 10px;">ðŸ¤–</div>
                    <div class="chart-title" style="color: white; margin-bottom: 10px;">AI-Powered Insights & Recommendations</div>
                    <p style="opacity: 0.9; font-size: 14px;">Executive-level analysis â€¢ C-suite quality â€¢ Actionable recommendations</p>
                </div>
            </div>
            <div id="insightsContainer"></div>
        </div>
    </div>

    <script>
        const DATA = [
        {
                "show": "Sanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 1485318.0,
                "trials": 4597,
                "cac": 323.0,
                "ir": 11.0,
                "tr": 25.62,
                "tcr": 35.12,
                "ctr": 0.5
        },
        {
                "show": "CBKR",
                "channel": "meta",
                "platform": "app",
                "spend": 443599.0,
                "trials": 1275,
                "cac": 348.0,
                "ir": 15.0,
                "tr": 56.67,
                "tcr": 38.58,
                "ctr": 1.1
        },
        {
                "show": "AndaGang",
                "channel": "meta",
                "platform": "app",
                "spend": 186503.0,
                "trials": 278,
                "cac": 671.0,
                "ir": 4.0,
                "tr": 27.74,
                "tcr": 41.79,
                "ctr": 0.6
        },
        {
                "show": "MPJ",
                "channel": "meta",
                "platform": "app",
                "spend": 183984.0,
                "trials": 432,
                "cac": 426.0,
                "ir": 6.0,
                "tr": 55.24,
                "tcr": 34.91,
                "ctr": 0.6
        },
        {
                "show": "VB2",
                "channel": "meta",
                "platform": "app",
                "spend": 138634.0,
                "trials": 84,
                "cac": 1650.0,
                "ir": 1.0,
                "tr": 28.0,
                "tcr": 34.18,
                "ctr": 1.4
        },
        {
                "show": "Randeep Hooda",
                "channel": "meta",
                "platform": "app",
                "spend": 93804.0,
                "trials": 148,
                "cac": 634.0,
                "ir": 3.0,
                "tr": 45.68,
                "tcr": 24.63,
                "ctr": 0.4
        },
        {
                "show": "Kayantar",
                "channel": "meta",
                "platform": "app",
                "spend": 80146.0,
                "trials": 123,
                "cac": 652.0,
                "ir": 2.0,
                "tr": 38.8,
                "tcr": 33.62,
                "ctr": 1.7
        },
        {
                "show": "Muawja",
                "channel": "meta",
                "platform": "app",
                "spend": 41464.0,
                "trials": 29,
                "cac": 1430.0,
                "ir": 0.0,
                "tr": 26.85,
                "tcr": 33.33,
                "ctr": 5.3
        },
        {
                "show": "HusbandOnSale",
                "channel": "meta",
                "platform": "app",
                "spend": 8588.0,
                "trials": 16,
                "cac": 537.0,
                "ir": 5.0,
                "tr": 53.33,
                "tcr": 53.85,
                "ctr": 1.2
        },
        {
                "show": "Consideration",
                "channel": "meta",
                "platform": "app",
                "spend": 8415.0,
                "trials": 4,
                "cac": 2104.0,
                "ir": 2.0,
                "tr": 13.33,
                "tcr": 25.0,
                "ctr": 1.1
        },
        {
                "show": "VideshiBahu",
                "channel": "meta",
                "platform": "app",
                "spend": 5708.0,
                "trials": 2,
                "cac": 2854.0,
                "ir": 1.0,
                "tr": 20.0,
                "tcr": 0.0,
                "ctr": 2.1
        },
        {
                "show": "KJ",
                "channel": "meta",
                "platform": "app",
                "spend": 4842.0,
                "trials": 11,
                "cac": 440.0,
                "ir": 0.0,
                "tr": 14.29,
                "tcr": 33.33,
                "ctr": 34.2
        },
        {
                "show": "NKB",
                "channel": "meta",
                "platform": "app",
                "spend": 2433.0,
                "trials": 14,
                "cac": 174.0,
                "ir": 8.0,
                "tr": 70.0,
                "tcr": 30.0,
                "ctr": 1.6
        },
        {
                "show": "ShaitaniTeddy",
                "channel": "meta",
                "platform": "app",
                "spend": 218.0,
                "trials": 1,
                "cac": 218.0,
                "ir": 0.0,
                "tr": 25.0,
                "tcr": 0,
                "ctr": 30.9
        },
        {
                "show": "Jholachhap",
                "channel": "meta",
                "platform": "app",
                "spend": 148.0,
                "trials": 0,
                "cac": 0,
                "ir": 0.0,
                "tr": 0,
                "tcr": 0,
                "ctr": 1.0
        },
        {
                "show": "AatmaExchange",
                "channel": "meta",
                "platform": "app",
                "spend": 2.0,
                "trials": 0,
                "cac": 0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 0.0
        },
        {
                "show": "Sanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 720140.0,
                "trials": 2236,
                "cac": 322.0,
                "ir": 9.0,
                "tr": 26.11,
                "tcr": 34.28,
                "ctr": 0.7
        },
        {
                "show": "MPJ",
                "channel": "meta",
                "platform": "app",
                "spend": 691148.0,
                "trials": 1549,
                "cac": 446.0,
                "ir": 5.0,
                "tr": 52.74,
                "tcr": 34.03,
                "ctr": 0.9
        },
        {
                "show": "CBKR",
                "channel": "meta",
                "platform": "app",
                "spend": 578774.0,
                "trials": 1956,
                "cac": 296.0,
                "ir": 14.0,
                "tr": 56.37,
                "tcr": 36.35,
                "ctr": 1.0
        },
        {
                "show": "AndaGang",
                "channel": "meta",
                "platform": "app",
                "spend": 323977.0,
                "trials": 805,
                "cac": 402.0,
                "ir": 9.0,
                "tr": 27.71,
                "tcr": 38.43,
                "ctr": 0.4
        },
        {
                "show": "HusbandOnSale",
                "channel": "meta",
                "platform": "app",
                "spend": 249881.0,
                "trials": 834,
                "cac": 300.0,
                "ir": 22.0,
                "tr": 56.35,
                "tcr": 39.95,
                "ctr": 0.5
        },
        {
                "show": "Maayajaal",
                "channel": "meta",
                "platform": "app",
                "spend": 182858.0,
                "trials": 732,
                "cac": 250.0,
                "ir": 15.0,
                "tr": 50.0,
                "tcr": 43.67,
                "ctr": 0.6
        },
        {
                "show": "Randeep Hooda",
                "channel": "meta",
                "platform": "app",
                "spend": 125376.0,
                "trials": 234,
                "cac": 536.0,
                "ir": 5.0,
                "tr": 40.77,
                "tcr": 31.98,
                "ctr": 0.5
        },
        {
                "show": "NKB",
                "channel": "meta",
                "platform": "app",
                "spend": 59868.0,
                "trials": 231,
                "cac": 259.0,
                "ir": 3.0,
                "tr": 56.76,
                "tcr": 38.81,
                "ctr": 2.8
        },
        {
                "show": "Jholachhap",
                "channel": "meta",
                "platform": "app",
                "spend": 35229.0,
                "trials": 74,
                "cac": 476.0,
                "ir": 3.0,
                "tr": 56.49,
                "tcr": 30.88,
                "ctr": 1.5
        },
        {
                "show": "AkhiriMulakat",
                "channel": "meta",
                "platform": "app",
                "spend": 30394.0,
                "trials": 22,
                "cac": 1382.0,
                "ir": 0.0,
                "tr": 25.0,
                "tcr": 25.0,
                "ctr": 9.0
        },
        {
                "show": "Muawja",
                "channel": "meta",
                "platform": "app",
                "spend": 26332.0,
                "trials": 14,
                "cac": 1881.0,
                "ir": 0.0,
                "tr": 23.73,
                "tcr": 6.67,
                "ctr": 4.0
        },
        {
                "show": "KJ",
                "channel": "meta",
                "platform": "app",
                "spend": 24518.0,
                "trials": 36,
                "cac": 681.0,
                "ir": 0.0,
                "tr": 14.88,
                "tcr": 25.81,
                "ctr": 32.1
        },
        {
                "show": "TaaleeEkGoonj",
                "channel": "meta",
                "platform": "app",
                "spend": 16440.0,
                "trials": 6,
                "cac": 2740.0,
                "ir": 1.0,
                "tr": 10.0,
                "tcr": 80.0,
                "ctr": 1.9
        },
        {
                "show": "Kayantar",
                "channel": "meta",
                "platform": "app",
                "spend": 14083.0,
                "trials": 16,
                "cac": 880.0,
                "ir": 1.0,
                "tr": 28.57,
                "tcr": 18.75,
                "ctr": 1.9
        },
        {
                "show": "ShaitaniTeddy",
                "channel": "meta",
                "platform": "app",
                "spend": 8628.0,
                "trials": 7,
                "cac": 1233.0,
                "ir": 0.0,
                "tr": 13.73,
                "tcr": 62.5,
                "ctr": 24.5
        },
        {
                "show": "Muaavja",
                "channel": "meta",
                "platform": "app",
                "spend": 6189.0,
                "trials": 3,
                "cac": 2063.0,
                "ir": 1.0,
                "tr": 11.11,
                "tcr": 0.0,
                "ctr": 5.1
        },
        {
                "show": "KirayeKiPatni",
                "channel": "meta",
                "platform": "app",
                "spend": 1272.0,
                "trials": 0,
                "cac": 0,
                "ir": 0.0,
                "tr": 0.0,
                "tcr": 0,
                "ctr": 14.7
        },
        {
                "show": "VB2",
                "channel": "meta",
                "platform": "app",
                "spend": 1132.0,
                "trials": 1,
                "cac": 1132.0,
                "ir": 0.0,
                "tr": 33.33,
                "tcr": 0,
                "ctr": 4.7
        },
        {
                "show": "Randeep Hooda",
                "channel": "meta",
                "platform": "web",
                "spend": 1227822.0,
                "trials": 4862,
                "cac": 253.0,
                "ir": 0,
                "tr": 0,
                "tcr": 12.1,
                "ctr": 18.0
        },
        {
                "show": "Sanwari",
                "channel": "meta",
                "platform": "web",
                "spend": 658875.0,
                "trials": 1895,
                "cac": 348.0,
                "ir": 0,
                "tr": 0,
                "tcr": 35.4,
                "ctr": 0.83
        },
        {
                "show": "CBKR",
                "channel": "meta",
                "platform": "web",
                "spend": 161277.0,
                "trials": 482,
                "cac": 335.0,
                "ir": 0,
                "tr": 0,
                "tcr": 20.1,
                "ctr": 11.99
        },
        {
                "show": "VideshiBahu",
                "channel": "meta",
                "platform": "web",
                "spend": 144401.0,
                "trials": 363,
                "cac": 398.0,
                "ir": 0,
                "tr": 0,
                "tcr": 12.4,
                "ctr": 9.63
        },
        {
                "show": "BewafaDarling",
                "channel": "meta",
                "platform": "web",
                "spend": 132783.0,
                "trials": 367,
                "cac": 362.0,
                "ir": 0,
                "tr": 0,
                "tcr": 49.9,
                "ctr": 2.09
        },
        {
                "show": "NKB",
                "channel": "meta",
                "platform": "web",
                "spend": 108277.0,
                "trials": 284,
                "cac": 381.0,
                "ir": 0,
                "tr": 0,
                "tcr": 9.6,
                "ctr": 20.02
        },
        {
                "show": "AndaGang",
                "channel": "meta",
                "platform": "web",
                "spend": 62037.0,
                "trials": 132,
                "cac": 470.0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 0.85
        },
        {
                "show": "HusbandOnSale",
                "channel": "meta",
                "platform": "web",
                "spend": 11880.0,
                "trials": 60,
                "cac": 198.0,
                "ir": 0,
                "tr": 0,
                "tcr": 34.1,
                "ctr": 2.66
        },
        {
                "show": "MPJ",
                "channel": "meta",
                "platform": "web",
                "spend": 10747.0,
                "trials": 22,
                "cac": 488.0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 2.22
        },
        {
                "show": "Maayajaal",
                "channel": "meta",
                "platform": "web",
                "spend": 83.0,
                "trials": 0,
                "cac": 0,
                "ir": 0,
                "tr": 0,
                "tcr": 0.0,
                "ctr": 1.22
        },
        {
                "show": "Kaand2010",
                "channel": "meta",
                "platform": "web",
                "spend": 11.0,
                "trials": 0,
                "cac": 0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 0.0
        },
        {
                "show": "Randeep Hooda",
                "channel": "meta",
                "platform": "web",
                "spend": 1032650.0,
                "trials": 5451,
                "cac": 189.0,
                "ir": 0,
                "tr": 0,
                "tcr": 15.0,
                "ctr": 17.43
        },
        {
                "show": "CBKR",
                "channel": "meta",
                "platform": "web",
                "spend": 372028.0,
                "trials": 1481,
                "cac": 251.0,
                "ir": 0,
                "tr": 0,
                "tcr": 12.3,
                "ctr": 13.34
        },
        {
                "show": "Sanwari",
                "channel": "meta",
                "platform": "web",
                "spend": 360936.0,
                "trials": 1725,
                "cac": 209.0,
                "ir": 0,
                "tr": 0,
                "tcr": 36.7,
                "ctr": 0.82
        },
        {
                "show": "NKB",
                "channel": "meta",
                "platform": "web",
                "spend": 155988.0,
                "trials": 593,
                "cac": 263.0,
                "ir": 0,
                "tr": 0,
                "tcr": 9.3,
                "ctr": 20.21
        },
        {
                "show": "VideshiBahu",
                "channel": "meta",
                "platform": "web",
                "spend": 51032.0,
                "trials": 196,
                "cac": 260.0,
                "ir": 0,
                "tr": 0,
                "tcr": 14.1,
                "ctr": 26.22
        },
        {
                "show": "HusbandOnSale",
                "channel": "meta",
                "platform": "web",
                "spend": 43561.0,
                "trials": 158,
                "cac": 276.0,
                "ir": 0,
                "tr": 0,
                "tcr": 31.4,
                "ctr": 3.74
        },
        {
                "show": "Maayajaal",
                "channel": "meta",
                "platform": "web",
                "spend": 39704.0,
                "trials": 117,
                "cac": 339.0,
                "ir": 0,
                "tr": 0,
                "tcr": 23.3,
                "ctr": 1.73
        },
        {
                "show": "BewafaDarling",
                "channel": "meta",
                "platform": "web",
                "spend": 24505.0,
                "trials": 128,
                "cac": 191.0,
                "ir": 0,
                "tr": 0,
                "tcr": 50.4,
                "ctr": 1.9
        },
        {
                "show": "MPJ",
                "channel": "meta",
                "platform": "web",
                "spend": 23015.0,
                "trials": 52,
                "cac": 443.0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 1.81
        },
        {
                "show": "AndaGang",
                "channel": "meta",
                "platform": "web",
                "spend": 19316.0,
                "trials": 42,
                "cac": 460.0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 1.79
        },
        {
                "show": "Kaand2010",
                "channel": "meta",
                "platform": "web",
                "spend": 1.0,
                "trials": 0,
                "cac": 0,
                "ir": 0,
                "tr": 0,
                "tcr": 0,
                "ctr": 0.0
        }
];
        let currentSortCol = 4; // Default sort by trials
        let sortAsc = false;

        function calculateMetrics(data) {
            const totalSpend = data.reduce((sum, row) => sum + row.spend, 0);
            const totalTrials = data.reduce((sum, row) => sum + row.trials, 0);
            const avgCAC = totalTrials > 0 ? (totalSpend / totalTrials) : 0;
            const totalIR = data.reduce((sum, row) => sum + (row.ir * row.trials), 0);
            const totalTR = data.reduce((sum, row) => sum + (row.tr * row.trials), 0);
            const totalTCR = data.reduce((sum, row) => sum + (row.tcr * row.trials), 0);
            const totalCTR = data.reduce((sum, row) => sum + (row.ctr * row.spend), 0);
            const avgIR = totalTrials > 0 ? (totalIR / totalTrials) : 0;
            const avgTR = totalTrials > 0 ? (totalTR / totalTrials) : 0;
            const avgTCR = totalTrials > 0 ? (totalTCR / totalTrials) : 0;
            const avgCTR = totalSpend > 0 ? (totalCTR / totalSpend) : 0;
            return { totalSpend, totalTrials, cac: avgCAC, ir: avgIR, tr: avgTR, tcr: avgTCR, ctr: avgCTR };
        }

        function calculateChannelMetrics(data, channel) {
            const filtered = data.filter(row => row.channel === channel);
            return calculateMetrics(filtered);
        }

        function calculatePlatformMetrics(data, platform) {
            const filtered = data.filter(row => row.platform === platform);
            return calculateMetrics(filtered);
        }

        function formatCurrency(num) { return 'â‚¹' + parseFloat(num).toLocaleString('en-IN'); }

        function renderMetrics() {
            const metrics = calculateMetrics(DATA);
            const grid = document.getElementById('metricsGrid');
            const cards = [
                { label: 'Total Spend', value: formatCurrency(metrics.totalSpend), status: '', healthy: true },
                { label: 'Total Trials', value: metrics.totalTrials.toLocaleString(), status: '', healthy: true },
                { label: 'Average CAC', value: formatCurrency(metrics.cac.toFixed(2)), status: metrics.cac < 250 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.cac < 250 },
                { label: 'CTR', value: metrics.ctr.toFixed(2) + '%', status: metrics.ctr > 0.75 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.ctr > 0.75 },
                { label: 'Install Rate (IR)', value: metrics.ir.toFixed(2) + '%', status: metrics.ir >= 10 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.ir >= 10 },
                { label: 'Trial Rate (TR)', value: metrics.tr.toFixed(2) + '%', status: metrics.tr >= 20 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.tr >= 20 },
                { label: 'D0 TCR', value: metrics.tcr.toFixed(2) + '%', status: metrics.tcr < 30 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.tcr < 30 }
            ];
            grid.innerHTML = cards.map(card => `
                <div class="metric-card ${card.healthy ? 'healthy' : 'unhealthy'}">
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    ${card.status ? `<div class="metric-status ${card.healthy ? 'healthy' : 'unhealthy'}">${card.status}</div>` : ''}
                </div>
            `).join('');
        }

        function renderChannelChart() {
            const meta = calculateChannelMetrics(DATA, 'meta');
            const google = calculateChannelMetrics(DATA, 'google');
            const ctx = document.getElementById('channelChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Spend (â‚¹)', 'Trials', 'CAC (â‚¹)', 'CTR%', 'IR%', 'TR%', 'TCR%'],
                    datasets: [
                        { label: 'Meta', data: [meta.totalSpend, meta.totalTrials, meta.cac, meta.ctr, meta.ir, meta.tr, meta.tcr], backgroundColor: '#3b82f6' },
                        { label: 'Google', data: [google.totalSpend, google.totalTrials, google.cac, google.ctr, google.ir, google.tr, google.tcr], backgroundColor: '#10b981' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function renderPlatformChart() {
            const app = calculatePlatformMetrics(DATA, 'app');
            const web = calculatePlatformMetrics(DATA, 'web');
            const ctx = document.getElementById('platformChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Spend (â‚¹)', 'Trials', 'CAC (â‚¹)', 'CTR%', 'IR%', 'TR%', 'TCR%'],
                    datasets: [
                        { label: 'App', data: [app.totalSpend, app.totalTrials, app.cac, app.ctr, app.ir, app.tr, app.tcr], backgroundColor: '#8b5cf6' },
                        { label: 'Web', data: [web.totalSpend, web.totalTrials, web.cac, web.ctr, web.ir, web.tr, web.tcr], backgroundColor: '#f97316' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function renderTable() {
            const tbody = document.getElementById('showsTableBody');
            const sorted = [...DATA].sort((a, b) => {
                const aVal = [a.show, a.channel, a.platform, a.spend, a.trials, a.cac, a.ir, a.tr, a.tcr, a.ctr][currentSortCol];
                const bVal = [b.show, b.channel, b.platform, b.spend, b.trials, b.cac, b.ir, b.tr, b.tcr, b.ctr][currentSortCol];
                return sortAsc ? (aVal > bVal ? 1 : -1) : (aVal < bVal ? 1 : -1);
            });
            tbody.innerHTML = sorted.map(row => `
                <tr>
                    <td><strong>${row.show}</strong></td>
                    <td><span class="channel-badge channel-${row.channel}">${row.channel}</span></td>
                    <td>${row.platform}</td>
                    <td>${formatCurrency(row.spend)}</td>
                    <td>${row.trials.toLocaleString()}</td>
                    <td>${formatCurrency(row.cac)}</td>
                    <td>${row.ir}%</td>
                    <td>${row.tr}%</td>
                    <td>${row.tcr}%</td>
                    <td>${row.ctr}%</td>
                </tr>
            `).join('');
        }

        function sortTable(col) {
            if (currentSortCol === col) sortAsc = !sortAsc;
            else { currentSortCol = col; sortAsc = false; }
            renderTable();
        }

        function generateInsights() {
            const metrics = calculateMetrics(DATA);
            const shows = [...DATA].sort((a, b) => b.trials - a.trials);
            const topShow = shows[0];
            const top3Shows = shows.slice(0, 3);

            const insights = [];

            // INSIGHT 1: Top Show Scaling Opportunity
            const topShowSpend = topShow.spend;
            const topShowTrials = topShow.trials;
            const projectedTrials = Math.floor(topShowTrials * 1.25);
            const additionalSpend = (projectedTrials - topShowTrials) * topShow.cac;

            insights.push({
                title: `ðŸš€ Scale "${topShow.show}" - Top Performer with ${topShowTrials.toLocaleString()} Trials`,
                analysis: `<strong>${topShow.show}</strong> is your strongest performer, generating <strong>${((topShowTrials/metrics.totalTrials)*100).toFixed(1)}%</strong> of total trials at â‚¹${topShow.cac} CAC. This show demonstrates proven product-market fit with ${topShow.channel} on ${topShow.platform}. Current spend: â‚¹${formatCurrency(topShowSpend)}. The CAC is <strong>${topShow.cac < 250 ? 'below target (healthy)' : 'above target'}</strong> and TCR is ${topShow.tcr}% ${topShow.tcr < 30 ? '(excellent retention)' : '(needs improvement)'}.`,
                recommendation: `<strong>ðŸ’¡ Immediate Action:</strong> Increase budget by <strong>20-25%</strong> (from â‚¹${(topShowSpend/100000).toFixed(1)}L to â‚¹${(topShowSpend*1.25/100000).toFixed(1)}L). Expected outcome: +${(projectedTrials - topShowTrials).toLocaleString()} trials for â‚¹${(additionalSpend/100000).toFixed(2)}L incremental spend. Maintain current creative and targeting strategies. Monitor daily for 5-7 days to ensure CAC stability.`,
                priority: 'high',
                impact: `Scaling top performer = ${(projectedTrials - topShowTrials).toLocaleString()} additional trials = â‚¹${((projectedTrials - topShowTrials) * topShow.cac / 100000).toFixed(2)}L efficient spend`
            });

            // INSIGHT 2: CAC Efficiency Analysis
            const efficientShows = shows.filter(s => s.cac < 250 && s.trials > 50);
            const inefficientShows = shows.filter(s => s.cac >= 250);
            const avgEfficientCAC = efficientShows.length > 0 ?
                (efficientShows.reduce((sum, s) => sum + s.cac, 0) / efficientShows.length).toFixed(0) : metrics.cac;

            insights.push({
                title: `ðŸ’° CAC Analysis: â‚¹${metrics.cac.toFixed(0)} Blended ${metrics.cac < 250 ? 'âœ… Below Target' : 'âš ï¸ Above Target'}`,
                analysis: `Blended CAC of <strong>â‚¹${metrics.cac.toFixed(0)}</strong> vs â‚¹250 target. <strong>${efficientShows.length} of ${shows.length} shows</strong> operate below target CAC (avg â‚¹${avgEfficientCAC}), driving ${((efficientShows.reduce((s,sh)=>s+sh.trials,0)/metrics.totalTrials)*100).toFixed(1)}% of volume. ${inefficientShows.length > 0 ? `<strong style="color: #ef4444;">${inefficientShows.length} shows exceed â‚¹250 CAC</strong>: ${inefficientShows.slice(0,3).map(s => s.show + ' (â‚¹' + s.cac + ')').join(', ')}. These shows require optimization or budget reallocation.` : 'All shows performing efficiently - excellent portfolio health.'}`,
                recommendation: `<strong>ðŸ’¡ Action Plan:</strong><br>1. <strong>SCALE:</strong> Increase budget 20% for efficient shows: ${efficientShows.slice(0,3).map(s => s.show).join(', ')}.<br>2. ${inefficientShows.length > 0 ? `<strong>OPTIMIZE/PAUSE:</strong> Reduce spend 30-50% on ${inefficientShows.slice(0,2).map(s => s.show).join(', ')} until CAC improves below â‚¹280. Test new creatives and audiences.` : 'Maintain current efficiency - monitor for creative fatigue.'} <br>3. Reallocate â‚¹${((inefficientShows.reduce((s,sh)=>s+sh.spend,0)*0.4)/100000).toFixed(1)}L from inefficient to efficient shows.`,
                priority: metrics.cac > 250 ? 'high' : 'medium',
                impact: `CAC optimization = estimated â‚¹${((metrics.totalSpend * 0.15) / 100000).toFixed(1)}L cost savings`
            });

            // INSIGHT 3: Channel Strategy
            const meta = calculateChannelMetrics(DATA, 'meta');
            const google = calculateChannelMetrics(DATA, 'google');
            const channelLeader = meta.cac < google.cac ? 'Meta' : 'Google';
            const cacDiff = Math.abs(meta.cac - google.cac).toFixed(0);
            const cacDiffPercent = (cacDiff / Math.min(meta.cac, google.cac) * 100).toFixed(0);

            insights.push({
                title: `ðŸŽ¯ Channel Mix: ${channelLeader} Outperforming by â‚¹${cacDiff} CAC (${cacDiffPercent}%)`,
                analysis: `<strong>Meta:</strong> ${meta.totalTrials.toLocaleString()} trials @ â‚¹${meta.cac.toFixed(0)} CAC (${(meta.totalTrials/metrics.totalTrials*100).toFixed(0)}% share, â‚¹${(meta.totalSpend/100000).toFixed(1)}L spend). <strong>Google:</strong> ${google.totalTrials.toLocaleString()} trials @ â‚¹${google.cac.toFixed(0)} CAC (${(google.totalTrials/metrics.totalTrials*100).toFixed(0)}% share, â‚¹${(google.totalSpend/100000).toFixed(1)}L spend). ${channelLeader} demonstrates <strong>â‚¹${cacDiff} lower CAC</strong> (+${cacDiffPercent}% efficiency edge).`,
                recommendation: `<strong>ðŸ’¡ Budget Rebalancing:</strong> ${channelLeader === 'Meta' ? `Shift 15-20% budget from Google to Meta. Increase Meta from â‚¹${(meta.totalSpend/100000).toFixed(1)}L to â‚¹${(meta.totalSpend*1.2/100000).toFixed(1)}L. ${cacDiffPercent > 20 ? 'Significant efficiency gap - prioritize Meta scaling.' : 'Maintain Google for audience diversification.'}` : `Scale Google campaigns 15-20%. ${cacDiffPercent > 20 ? 'Review Meta creative fatigue and audience saturation.' : 'Maintain balanced mix.'}`} Target: Reduce blended CAC to â‚¹${(metrics.cac * 0.93).toFixed(0)}.`,
                priority: cacDiffPercent > 20 ? 'high' : 'medium',
                impact: `Channel optimization = estimated +${Math.floor(metrics.totalSpend/Math.min(meta.cac, google.cac) - metrics.totalTrials).toLocaleString()} trials`
            });

            // INSIGHT 4: Retention & TCR
            const healthyTCRShows = shows.filter(s => s.tcr < 30);
            const poorTCRShows = shows.filter(s => s.tcr >= 30);
            const lostTrials = poorTCRShows.reduce((sum, s) => {
                const excessChurn = Math.max(0, (s.tcr - 29) / 100);
                return sum + Math.floor(s.trials * excessChurn);
            }, 0);

            insights.push({
                title: `${metrics.tcr < 30 ? 'âœ…' : 'ðŸš¨'} Trial Retention: ${metrics.tcr.toFixed(1)}% TCR ${metrics.tcr < 30 ? 'Healthy' : 'CRITICAL'}`,
                analysis: `Overall D0 churn at <strong>${metrics.tcr.toFixed(1)}%</strong> vs <30% target. ${healthyTCRShows.length} shows meet retention target${healthyTCRShows.length > 0 ? ` (${healthyTCRShows.slice(0,2).map(s => s.show + ': ' + s.tcr + '%').join(', ')})` : ''}. ${poorTCRShows.length > 0 ? `<strong style="color: #ef4444;">${poorTCRShows.length} shows exceed 30% churn</strong>, bleeding approximately <strong>${lostTrials.toLocaleString()} trials</strong> worth â‚¹${((lostTrials * metrics.cac)/100000).toFixed(1)}L.` : 'Excellent retention across portfolio.'}`,
                recommendation: `<strong>ðŸ’¡ Retention Strategy:</strong> ${metrics.tcr >= 30 ? `<strong>URGENT:</strong> Audit content quality, onboarding UX, and trial value prop for ${poorTCRShows.map(s=>s.show).join(', ')}. Benchmark best performer against worst. Implement fixes within 48 hours. Target: Reduce TCR to <28%.` : `Maintain retention excellence. Document success factors from top performers and replicate. Continue A/B testing onboarding improvements.`}`,
                priority: metrics.tcr >= 30 ? 'high' : 'low',
                impact: `Fixing retention = ${lostTrials.toLocaleString()} trial recovery = â‚¹${((lostTrials * metrics.cac)/100000).toFixed(1)}L cost avoidance`
            });

            // INSIGHT 5: Platform Strategy
            const app = calculatePlatformMetrics(DATA, 'app');
            const web = calculatePlatformMetrics(DATA, 'web');
            const platformLeader = app.cac < web.cac ? 'App' : 'Web';

            insights.push({
                title: `ðŸ’» Platform Mix: ${platformLeader} Leading with â‚¹${Math.min(app.cac, web.cac).toFixed(0)} CAC`,
                analysis: `<strong>App:</strong> ${app.totalTrials.toLocaleString()} trials @ â‚¹${app.cac.toFixed(0)} CAC. <strong>Web:</strong> ${web.totalTrials.toLocaleString()} trials @ â‚¹${web.cac.toFixed(0)} CAC. Platform split: ${(app.totalTrials/metrics.totalTrials*100).toFixed(0)}% App, ${(web.totalTrials/metrics.totalTrials*100).toFixed(0)}% Web. ${platformLeader} demonstrates better cost efficiency.`,
                recommendation: `<strong>ðŸ’¡ Platform Optimization:</strong> ${platformLeader === 'App' ? 'Prioritize app install campaigns. Optimize app store listing (screenshots, reviews). Consider app-only promotional offers.' : 'Focus on web conversion optimization. Improve landing page UX and reduce signup friction. Test progressive web app (PWA).'}`,
                priority: 'medium',
                impact: `Platform optimization = estimated +${Math.floor(metrics.totalTrials * 0.08).toLocaleString()} trials`
            });

            // Sort by priority
            insights.sort((a, b) => {
                const priority = { high: 3, medium: 2, low: 1 };
                return priority[b.priority] - priority[a.priority];
            });

            return insights;
        }

        function renderInsights() {
            const insights = generateInsights();
            const container = document.getElementById('insightsContainer');

            container.innerHTML = `
                <div style="background: #f0fdf4; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #10b981;">
                    <strong style="font-size: 16px; color: #065f46;">ðŸ“Š Analysis Summary</strong><br>
                    <span style="color: #047857; font-size: 14px;">
                        Generated ${insights.length} executive insights â€¢
                        ${insights.filter(i => i.priority === 'high').length} high priority â€¢
                        ${insights.filter(i => i.priority === 'medium').length} medium priority â€¢
                        ${insights.filter(i => i.priority === 'low').length} low priority
                    </span>
                </div>
            ` + insights.map((insight, idx) => `
                <div class="insight-card ${insight.priority}">
                    <span class="insight-badge ${insight.priority}">${insight.priority.toUpperCase()} PRIORITY</span>
                    <div class="insight-title">${idx + 1}. ${insight.title}</div>
                    <div class="insight-analysis">${insight.analysis}</div>
                    <div class="insight-recommendation">${insight.recommendation}</div>
                    <div class="insight-impact"><strong>ðŸ’¼ Business Impact:</strong> ${insight.impact}</div>
                </div>
            `).join('');
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                document.getElementById('tab-' + e.target.dataset.tab).classList.add('active');
                if (e.target.dataset.tab === 'channel') renderChannelChart();
                if (e.target.dataset.tab === 'platform') renderPlatformChart();
                if (e.target.dataset.tab === 'insights') renderInsights();
            });
        });

        renderMetrics();
        renderTable();
        console.log('âœ… Dashboard loaded with', DATA.length, 'shows for Haryanvi (HR) Market');
    </script>
</body>
</html>