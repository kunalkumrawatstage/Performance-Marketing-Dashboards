<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STAGE Performance Dashboard - Gujarati Market</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header { background: white; padding: 25px 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #2563eb; font-size: 24px; }
        .header p { color: #666; font-size: 14px; margin-top: 5px; }

        .success { background: #f0fdf4; color: #15803d; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #22c55e; font-size: 14px; }

        .tab-nav { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border: none; background: transparent; color: #666; font-weight: 500; cursor: pointer; border-radius: 6px; transition: all 0.2s; white-space: nowrap; }
        .tab-btn:hover { background: #f3f4f6; color: #2563eb; }
        .tab-btn.active { background: #2563eb; color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .metric-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #2563eb; }
        .metric-card.healthy { border-left-color: #10b981; }
        .metric-card.unhealthy { border-left-color: #ef4444; }
        .metric-label { font-size: 13px; color: #666; margin-bottom: 8px; font-weight: 500; }
        .metric-value { font-size: 28px; font-weight: 700; color: #111; margin-bottom: 5px; }
        .metric-status { font-size: 12px; font-weight: 600; }
        .metric-status.healthy { color: #10b981; }
        .metric-status.unhealthy { color: #ef4444; }

        .chart-section { background: white; border-radius: 10px; padding: 30px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chart-title { font-size: 18px; font-weight: 600; color: #111; margin-bottom: 20px; }
        .chart-container { position: relative; height: 400px; }

        .shows-table { background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f3f4f6; padding: 12px; text-align: left; font-weight: 600; font-size: 13px; color: #374151; border-bottom: 2px solid #e5e7eb; cursor: pointer; }
        th:hover { background: #e5e7eb; }
        td { padding: 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; }
        tr:hover { background: #f9fafb; }
        .channel-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .channel-meta { background: #dbeafe; color: #1e40af; }
        .channel-google { background: #d1fae5; color: #065f46; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ðŸ“Š STAGE Performance Dashboard</h1>
                <p>Gujarati Market â€¢ Data Pre-Loaded âœ…</p>
            </div>
        </div>

        <div class="success">
            âœ… Dashboard generated with 27 show records â€¢ No file upload needed!
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="overall">ðŸ“ˆ Overall Performance</button>
            <button class="tab-btn" data-tab="channel">ðŸŽ¯ Channel Analysis</button>
            <button class="tab-btn" data-tab="platform">ðŸ’» Platform Breakdown</button>
            <button class="tab-btn" data-tab="shows">ðŸŽ¬ Show Performance</button>
        </div>

        <div id="tab-overall" class="tab-content active">
            <div class="metrics-grid" id="metricsGrid"></div>
        </div>

        <div id="tab-channel" class="tab-content">
            <div class="chart-section">
                <div class="chart-title">ðŸ“Š Channel Performance: Meta vs Google</div>
                <div class="chart-container">
                    <canvas id="channelChart"></canvas>
                </div>
            </div>
        </div>

        <div id="tab-platform" class="tab-content">
            <div class="chart-section">
                <div class="chart-title">ðŸ’» Platform Performance: App vs Web</div>
                <div class="chart-container">
                    <canvas id="platformChart"></canvas>
                </div>
            </div>
        </div>

        <div id="tab-shows" class="tab-content">
            <div class="shows-table">
                <div class="chart-title">ðŸ“ˆ Show Performance Details</div>
                <table id="showsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Show â†•</th>
                            <th onclick="sortTable(1)">Channel â†•</th>
                            <th onclick="sortTable(2)">Platform â†•</th>
                            <th onclick="sortTable(3)">Spend (â‚¹) â†•</th>
                            <th onclick="sortTable(4)">Trials â†•</th>
                            <th onclick="sortTable(5)">CAC (â‚¹) â†•</th>
                            <th onclick="sortTable(6)">IR% â†•</th>
                            <th onclick="sortTable(7)">TR% â†•</th>
                            <th onclick="sortTable(8)">TCR% â†•</th>
                            <th onclick="sortTable(9)">CTR% â†•</th>
                        </tr>
                    </thead>
                    <tbody id="showsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const DATA = [
        {
                "show": "Saanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 1007212.0,
                "trials": 3555,
                "cac": 283.0,
                "ir": 13.14,
                "tr": 25.02,
                "tcr": 32.04,
                "ctr": 0.55
        },
        {
                "show": "31st",
                "channel": "meta",
                "platform": "app",
                "spend": 593574.0,
                "trials": 2362,
                "cac": 251.0,
                "ir": 21.13,
                "tr": 28.43,
                "tcr": 31.51,
                "ctr": 0.45
        },
        {
                "show": "JholaChhap",
                "channel": "meta",
                "platform": "app",
                "spend": 106186.0,
                "trials": 219,
                "cac": 485.0,
                "ir": 6.82,
                "tr": 28.82,
                "tcr": 38.27,
                "ctr": 0.62
        },
        {
                "show": "Minzar",
                "channel": "meta",
                "platform": "app",
                "spend": 88201.0,
                "trials": 209,
                "cac": 422.0,
                "ir": 18.76,
                "tr": 15.71,
                "tcr": 29.61,
                "ctr": 0.71
        },
        {
                "show": "BuilderBoys",
                "channel": "meta",
                "platform": "app",
                "spend": 60660.0,
                "trials": 121,
                "cac": 501.0,
                "ir": 21.33,
                "tr": 14.94,
                "tcr": 35.24,
                "ctr": 0.38
        },
        {
                "show": "Punarjanam",
                "channel": "meta",
                "platform": "app",
                "spend": 19225.0,
                "trials": 33,
                "cac": 583.0,
                "ir": 6.32,
                "tr": 28.7,
                "tcr": 31.03,
                "ctr": 0.93
        },
        {
                "show": "BewafaDarling",
                "channel": "meta",
                "platform": "app",
                "spend": 6725.0,
                "trials": 2,
                "cac": 3363.0,
                "ir": 1.68,
                "tr": 15.38,
                "tcr": 0.0,
                "ctr": 1.87
        },
        {
                "show": "VideshiBahu",
                "channel": "meta",
                "platform": "app",
                "spend": 4311.0,
                "trials": 7,
                "cac": 616.0,
                "ir": 10.33,
                "tr": 20.59,
                "tcr": 0.0,
                "ctr": 0.49
        },
        {
                "show": "Akshar",
                "channel": "meta",
                "platform": "app",
                "spend": 3874.0,
                "trials": 6,
                "cac": 646.0,
                "ir": 14.87,
                "tr": 15.0,
                "tcr": 66.67,
                "ctr": 0.24
        },
        {
                "show": "Saanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 115300.0,
                "trials": 784,
                "cac": 147.0,
                "ir": 24.53,
                "tr": 31.95,
                "tcr": 37.32,
                "ctr": 0.44
        },
        {
                "show": "31st",
                "channel": "meta",
                "platform": "app",
                "spend": 29021.0,
                "trials": 241,
                "cac": 120.0,
                "ir": 30.84,
                "tr": 32.61,
                "tcr": 34.6,
                "ctr": 0.81
        },
        {
                "show": "Akshar",
                "channel": "meta",
                "platform": "app",
                "spend": 22074.0,
                "trials": 30,
                "cac": 736.0,
                "ir": 11.81,
                "tr": 19.23,
                "tcr": 61.54,
                "ctr": 0.42
        },
        {
                "show": "JholaChhap",
                "channel": "meta",
                "platform": "app",
                "spend": 11520.0,
                "trials": 32,
                "cac": 360.0,
                "ir": 9.71,
                "tr": 39.51,
                "tcr": 28.57,
                "ctr": 0.68
        },
        {
                "show": "Minzar",
                "channel": "meta",
                "platform": "app",
                "spend": 6981.0,
                "trials": 13,
                "cac": 537.0,
                "ir": 19.26,
                "tr": 27.66,
                "tcr": 44.44,
                "ctr": 0.32
        },
        {
                "show": "BuilderBoys",
                "channel": "meta",
                "platform": "app",
                "spend": 6013.0,
                "trials": 13,
                "cac": 463.0,
                "ir": 28.34,
                "tr": 18.57,
                "tcr": 20.0,
                "ctr": 0.56
        },
        {
                "show": "Saanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 36545.0,
                "trials": 151,
                "cac": 242.0,
                "ir": 13.78,
                "tr": 32.06,
                "tcr": 32.58,
                "ctr": 0.61
        },
        {
                "show": "Saanwari",
                "channel": "meta",
                "platform": "app",
                "spend": 8485.0,
                "trials": 36,
                "cac": 236.0,
                "ir": 12.52,
                "tr": 53.73,
                "tcr": 31.25,
                "ctr": 0.64
        },
        {
                "show": "Saanwari",
                "channel": "meta",
                "platform": "web",
                "spend": 151438.0,
                "trials": 640,
                "cac": 237.0,
                "ir": 0,
                "tr": 0,
                "tcr": 39.34,
                "ctr": 0.94
        },
        {
                "show": "Saanwari",
                "channel": "google",
                "platform": "app",
                "spend": 380219.0,
                "trials": 974,
                "cac": 390.0,
                "ir": 6.21,
                "tr": 14.71,
                "tcr": 30.64,
                "ctr": 1.6
        },
        {
                "show": "Minzar",
                "channel": "google",
                "platform": "app",
                "spend": 30716.0,
                "trials": 44,
                "cac": 698.0,
                "ir": 4.41,
                "tr": 16.54,
                "tcr": 29.55,
                "ctr": 1.6
        },
        {
                "show": "BuilderBoys",
                "channel": "google",
                "platform": "app",
                "spend": 7931.0,
                "trials": 25,
                "cac": 317.0,
                "ir": 12.2,
                "tr": 16.23,
                "tcr": 28.0,
                "ctr": 1.39
        },
        {
                "show": "bewafadarling",
                "channel": "google",
                "platform": "app",
                "spend": 6869.0,
                "trials": 2,
                "cac": 2290.0,
                "ir": 5.06,
                "tr": 9.09,
                "tcr": 66.67,
                "ctr": 0.56
        },
        {
                "show": "punarjanam",
                "channel": "google",
                "platform": "app",
                "spend": 1792.0,
                "trials": 4,
                "cac": 448.0,
                "ir": 11.58,
                "tr": 11.11,
                "tcr": 0.0,
                "ctr": 1.34
        },
        {
                "show": "videshibahu",
                "channel": "google",
                "platform": "app",
                "spend": 1277.0,
                "trials": 5,
                "cac": 255.0,
                "ir": 9.35,
                "tr": 19.23,
                "tcr": 20.0,
                "ctr": 1.11
        },
        {
                "show": "GJ31st",
                "channel": "google",
                "platform": "app",
                "spend": 1165.0,
                "trials": 1,
                "cac": 1165.0,
                "ir": 10.93,
                "tr": 5.0,
                "tcr": 0.0,
                "ctr": 1.13
        },
        {
                "show": "jholachhap",
                "channel": "google",
                "platform": "app",
                "spend": 1103.0,
                "trials": 2,
                "cac": 551.0,
                "ir": 6.41,
                "tr": 20.0,
                "tcr": 50.0,
                "ctr": 1.31
        },
        {
                "show": "Saanwari",
                "channel": "google",
                "platform": "app",
                "spend": 10250.0,
                "trials": 40,
                "cac": 256.0,
                "ir": 22.59,
                "tr": 10.47,
                "tcr": 30.0,
                "ctr": 0.94
        }
];
        let currentSortCol = 4; // Default sort by trials
        let sortAsc = false;

        function calculateMetrics(data) {
            const totalSpend = data.reduce((sum, row) => sum + row.spend, 0);
            const totalTrials = data.reduce((sum, row) => sum + row.trials, 0);
            const avgCAC = totalTrials > 0 ? (totalSpend / totalTrials) : 0;
            const totalIR = data.reduce((sum, row) => sum + (row.ir * row.trials), 0);
            const totalTR = data.reduce((sum, row) => sum + (row.tr * row.trials), 0);
            const totalTCR = data.reduce((sum, row) => sum + (row.tcr * row.trials), 0);
            const totalCTR = data.reduce((sum, row) => sum + (row.ctr * row.spend), 0);
            const avgIR = totalTrials > 0 ? (totalIR / totalTrials) : 0;
            const avgTR = totalTrials > 0 ? (totalTR / totalTrials) : 0;
            const avgTCR = totalTrials > 0 ? (totalTCR / totalTrials) : 0;
            const avgCTR = totalSpend > 0 ? (totalCTR / totalSpend) : 0;
            return { totalSpend, totalTrials, cac: avgCAC, ir: avgIR, tr: avgTR, tcr: avgTCR, ctr: avgCTR };
        }

        function calculateChannelMetrics(data, channel) {
            const filtered = data.filter(row => row.channel === channel);
            return calculateMetrics(filtered);
        }

        function calculatePlatformMetrics(data, platform) {
            const filtered = data.filter(row => row.platform === platform);
            return calculateMetrics(filtered);
        }

        function formatCurrency(num) { return 'â‚¹' + parseFloat(num).toLocaleString('en-IN'); }

        function renderMetrics() {
            const metrics = calculateMetrics(DATA);
            const grid = document.getElementById('metricsGrid');
            const cards = [
                { label: 'Total Spend', value: formatCurrency(metrics.totalSpend), status: '', healthy: true },
                { label: 'Total Trials', value: metrics.totalTrials.toLocaleString(), status: '', healthy: true },
                { label: 'Average CAC', value: formatCurrency(metrics.cac.toFixed(2)), status: metrics.cac < 250 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.cac < 250 },
                { label: 'CTR', value: metrics.ctr.toFixed(2) + '%', status: metrics.ctr > 0.75 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.ctr > 0.75 },
                { label: 'Install Rate (IR)', value: metrics.ir.toFixed(2) + '%', status: metrics.ir >= 10 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.ir >= 10 },
                { label: 'Trial Rate (TR)', value: metrics.tr.toFixed(2) + '%', status: metrics.tr >= 20 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.tr >= 20 },
                { label: 'D0 TCR', value: metrics.tcr.toFixed(2) + '%', status: metrics.tcr < 30 ? 'Healthy âœ…' : 'Needs Attention âš ï¸', healthy: metrics.tcr < 30 }
            ];
            grid.innerHTML = cards.map(card => `
                <div class="metric-card ${card.healthy ? 'healthy' : 'unhealthy'}">
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    ${card.status ? `<div class="metric-status ${card.healthy ? 'healthy' : 'unhealthy'}">${card.status}</div>` : ''}
                </div>
            `).join('');
        }

        function renderChannelChart() {
            const meta = calculateChannelMetrics(DATA, 'meta');
            const google = calculateChannelMetrics(DATA, 'google');
            const ctx = document.getElementById('channelChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Spend (â‚¹)', 'Trials', 'CAC (â‚¹)', 'CTR%', 'IR%', 'TR%', 'TCR%'],
                    datasets: [
                        { label: 'Meta', data: [meta.totalSpend, meta.totalTrials, meta.cac, meta.ctr, meta.ir, meta.tr, meta.tcr], backgroundColor: '#3b82f6' },
                        { label: 'Google', data: [google.totalSpend, google.totalTrials, google.cac, google.ctr, google.ir, google.tr, google.tcr], backgroundColor: '#10b981' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function renderPlatformChart() {
            const app = calculatePlatformMetrics(DATA, 'app');
            const web = calculatePlatformMetrics(DATA, 'web');
            const ctx = document.getElementById('platformChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Spend (â‚¹)', 'Trials', 'CAC (â‚¹)', 'CTR%', 'IR%', 'TR%', 'TCR%'],
                    datasets: [
                        { label: 'App', data: [app.totalSpend, app.totalTrials, app.cac, app.ctr, app.ir, app.tr, app.tcr], backgroundColor: '#8b5cf6' },
                        { label: 'Web', data: [web.totalSpend, web.totalTrials, web.cac, web.ctr, web.ir, web.tr, web.tcr], backgroundColor: '#f97316' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function renderTable() {
            const tbody = document.getElementById('showsTableBody');
            const sorted = [...DATA].sort((a, b) => {
                const aVal = [a.show, a.channel, a.platform, a.spend, a.trials, a.cac, a.ir, a.tr, a.tcr, a.ctr][currentSortCol];
                const bVal = [b.show, b.channel, b.platform, b.spend, b.trials, b.cac, b.ir, b.tr, b.tcr, b.ctr][currentSortCol];
                return sortAsc ? (aVal > bVal ? 1 : -1) : (aVal < bVal ? 1 : -1);
            });
            tbody.innerHTML = sorted.map(row => `
                <tr>
                    <td><strong>${row.show}</strong></td>
                    <td><span class="channel-badge channel-${row.channel}">${row.channel}</span></td>
                    <td>${row.platform}</td>
                    <td>${formatCurrency(row.spend)}</td>
                    <td>${row.trials.toLocaleString()}</td>
                    <td>${formatCurrency(row.cac)}</td>
                    <td>${row.ir}%</td>
                    <td>${row.tr}%</td>
                    <td>${row.tcr}%</td>
                    <td>${row.ctr}%</td>
                </tr>
            `).join('');
        }

        function sortTable(col) {
            if (currentSortCol === col) sortAsc = !sortAsc;
            else { currentSortCol = col; sortAsc = false; }
            renderTable();
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                document.getElementById('tab-' + e.target.dataset.tab).classList.add('active');
                if (e.target.dataset.tab === 'channel') renderChannelChart();
                if (e.target.dataset.tab === 'platform') renderPlatformChart();
            });
        });

        renderMetrics();
        renderTable();
        console.log('âœ… Dashboard loaded with', DATA.length, 'shows');
    </script>
</body>
</html>